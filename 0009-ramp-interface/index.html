
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="The Tremor Team" name="author"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.2.6" name="generator"/>
<title>0009-ramp-interface - Tremor RFCs</title>
<link href="../assets/stylesheets/main.802231af.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<meta content="#000000" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="black" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#summary">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Tremor RFCs" class="md-header__button md-logo" data-md-component="logo" href=".." title="Tremor RFCs">
<img alt="logo" src="../img/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Tremor RFCs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              0009-ramp-interface
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/tremor-rs/tremor-rfcs/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    tremor-rs/tremor-rfcs
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Tremor RFCs" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Tremor RFCs">
<img alt="logo" src="../img/logo.png"/>
</a>
    Tremor RFCs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/tremor-rs/tremor-rfcs/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    tremor-rs/tremor-rfcs
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_changes/">
        API Changes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../arch_changes/">
        Architectural Changes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lang_changes/">
        Language Changes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../libs_changes/">
        Library Changes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0000-template/">
        RFC Template
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
        RFCs
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="RFCs" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          RFCs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../0001-remove-actix-from-tremor-runtime/">
        0001-remove-actix-from-tremor-runtime
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0002-pipeline-state-mechanism/">
        0002-pipeline-state-mechanism
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0003-linked-transports/">
        0003-linked-transports
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0004-sliding-window-mechanism/">
        0004-sliding-window-mechanism
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0005-circuit-breaker-mechanism/">
        0005-circuit-breaker-mechanism
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0006-plugin-development-kit/">
        0006-plugin-development-kit
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0007-pipeline-optimizations/">
        0007-pipeline-optimizations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0008-onramp-postgres/">
        0008-onramp-postgres
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<a class="md-nav__link md-nav__link--active" href="./">
        0009-ramp-interface
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0010-modularity/">
        0010-modularity
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0011-string-interpolation/">
        0011-string-interpolation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0012-correlation/">
        0012-correlation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0013-expr-based-path/">
        0013-expr-based-path
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/tremor-rs/tremor-rfcs/edit/main/0009-ramp-interface.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<ul>
<li>Feature Name: ramp-interface</li>
<li>Start Date: 2020-03-09</li>
<li>Tremor Issue: <a href="https://github.com/tremor-rs/tremor-runtime/issues/108">tremor-rs/tremor-runtime#0108</a> TBD</li>
<li>RFC PR: <a href="https://github.com/tremor-rs/tremor-rfcs/pull/0018">tremor-rs/tremor-rfcs#0018</a></li>
</ul>
<h1 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h1>
<p>This RFC proposes a generalized interface for onramps(sources) and offramps(sinks). This interface can serve as a basis for the PDK as it unifies how tremor core addresses ramps. As a second benefit, it could serve as a de facto standard for sources and sinks in the broader rust event processing ecosystem.</p>
<h1 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">¶</a></h1>
<p>The <a href="https://rfcs.tremor.rs/0006-plugin-development-kit/">RFC 0006</a> outlines the need and plan to implement a plugin development kit allow decoupling parts of tremor to make development less centered around a single artifact.</p>
<p>To enable plugins, plugins of the same type need to share a standard interface over which they communicate with the outside world. As of today, ramps are the least standardized component in tremor where each ramp, in no small degree, "does its own thing." A standardized interface paves the way to implement ramps in the PDK.</p>
<p>The secondary motivation is that there is an emerging event processing ecosystem in the rust world, providing a standardized interface that helps code reusability, quality, and sharing. For example, sharing code with timber.io's Vector project could become possible.</p>
<h1 id="guide-level-explanation">Guide-level explanation<a class="headerlink" href="#guide-level-explanation" title="Permanent link">¶</a></h1>
<p>We introduce a Sink and a Source trait. Those traits abstract over the following parts:</p>
<ul>
<li>configuration</li>
<li>data handling</li>
<li>status handling (errors, failures, backpressure for sinks)</li>
<li>lifetime management (initialization and shutdown)</li>
<li>event handoff (either to or from the onramp)</li>
<li>circuit breaker control/signals/events</li>
<li>support for guaranteed delivery</li>
</ul>
<p>These interface changes trigger a redesign of the current codecs and pre/post processors as they would likely be outside of the scope of a sink or source.</p>
<h1 id="reference-level-explanation">Reference-level explanation<a class="headerlink" href="#reference-level-explanation" title="Permanent link">¶</a></h1>
<p>We should discuss the communication design at this part to provide reasoning as to why it is sound.</p>
<p>To enable circuit breakers and guaranteed delivery, we need to communicate from a source through a pipeline to an offramp. This model comes with a challenge of a possible live lock at the source and pipeline level. To elaborate, we look at the source as an example. The loop of communication creates the possibility that the source sends an event to the pipeline, blocking at a full queue. At the same time, the pipeline sends an insight to the source, also blocking at a full queue and thus locking forever.</p>
<p>To resolve the lock, we use an unbounded queue for insights. Without additional guarantees, unbounded queues hold the risk of uncontrolled risk. In the implementation we guard against that in two ways so we can guarantee a sound implementation:</p>
<ol>
<li>
<p>In both pipelines and sources, we always process insights first, so forward flow only happens when there is no contraflow remaining to process. By that, we guarantee that before we send an event, we drain all pending insights (and their unbounded queues).</p>
</li>
<li>
<p>Events create insights. Neither sinks nor pipelines can create an insight without a corresponding event. If no events flow forward, there is a finite number of insights to be processed, so while we use unbounded queues, we bound the number of insights that can exist between two events.</p>
</li>
</ol>
<h1 id="drawbacks">Drawbacks<a class="headerlink" href="#drawbacks" title="Permanent link">¶</a></h1>
<p>Generalized sinks and sources are less specialized than custom-built ones. The chances are good that it complicates some of the implementations and can have a slight negative impact on performance.</p>
<p>The implementation lends itself to adopt an async based implementation. A move from threads to async tasks puts a performance penalty on single pipeline deployments. The trade-off here is that an async implementation lends itself to higher concurrency situations and is less impacted when there are many more pipelines or ramps than available cores. Looking down the roadmap, this does provide the characteristics we need for clustering.</p>
<p>To put this in numbers here, a comparison of 0.8.0 compared with the async implementation. To do this, we ran the test with three physical cores and 42 threads (24 cores + 24 threads). We then run both 0.8.0 and current with 1, 2, 4, 8, 16, 32, and 64 pipelines and onramps against a single blackhole offramp and the throughput recorded.</p>
<table>
<thead>
<tr>
<th align="right">MB/s</th>
<th align="right">0.8 - 3</th>
<th align="right">cur - 3</th>
<th align="right">0.8 - 48</th>
<th align="right">cur - 48</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">1</td>
<td align="right">346.3</td>
<td align="right">273.8</td>
<td align="right">155.4</td>
<td align="right">128.6</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">303.9</td>
<td align="right">339.1</td>
<td align="right">261.2</td>
<td align="right">292.3</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">210.8</td>
<td align="right">342.7</td>
<td align="right">175.2</td>
<td align="right">234.2</td>
</tr>
<tr>
<td align="right">8</td>
<td align="right">78.2</td>
<td align="right">308.3</td>
<td align="right">163.6</td>
<td align="right">209.9</td>
</tr>
<tr>
<td align="right">16</td>
<td align="right">27.0</td>
<td align="right">265.6</td>
<td align="right">174.1</td>
<td align="right">210.9</td>
</tr>
<tr>
<td align="right">32</td>
<td align="right">8.2</td>
<td align="right">245.9</td>
<td align="right">173.0</td>
<td align="right">201.2</td>
</tr>
<tr>
<td align="right">64</td>
<td align="right">1.4</td>
<td align="right">229.8</td>
<td align="right">154.4</td>
<td align="right">197.4</td>
</tr>
</tbody>
</table>
<h1 id="rationale-and-alternatives">Rationale and alternatives<a class="headerlink" href="#rationale-and-alternatives" title="Permanent link">¶</a></h1>
<p>First of all, not generalizing ramps excludes them from the PDK.</p>
<p>The second rationale and alternative is the choice between a strictly threaded and an asynchronous model already described in the drawbacks section. It also details why the negative impact on single-threaded performance is a worthwhile trade-off.</p>
<h1 id="prior-art">Prior art<a class="headerlink" href="#prior-art" title="Permanent link">¶</a></h1>
<p>Generalized interfaces are a typical pattern. One example is the <a href="https://github.com/ring-clojure/ring">ring</a>, a common abstraction over web applications that allows the reuse of shared parts and logic. Other applications and domains use the same principle to create a more extensive ecosystem around a concept.</p>
<h1 id="unresolved-questions">Unresolved questions<a class="headerlink" href="#unresolved-questions" title="Permanent link">¶</a></h1>
<p>This RFC does not address linked on/offramps since they are a particular case.</p>
<h1 id="future-possibilities">Future possibilities<a class="headerlink" href="#future-possibilities" title="Permanent link">¶</a></h1>
<p>A further opportunity is to extend the concept of generalized ramps to linked on and offramps.</p>
<p>For the time being, Sinks and Sources exist as abstractions under the Onramp / Offramp model. We can remove this abstraction when we have ensured the model works with linked ramps.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 0008-onramp-postgres" class="md-footer__link md-footer__link--prev" href="../0008-onramp-postgres/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              0008-onramp-postgres
            </div>
</div>
</a>
<a aria-label="Next: 0010-modularity" class="md-footer__link md-footer__link--next" href="../0010-modularity/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              0010-modularity
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
<script src="../assets/javascripts/bundle.756773cc.min.js"></script>
<script src="https://unpkg.com/mermaid@8.8.4/dist/mermaid.min.js"></script>
</body>
</html>